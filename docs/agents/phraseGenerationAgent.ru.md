# Агент генерации фраз

Данный агент генерирует файл ostis-системы с текстом ответного сообщения, где названия sc-переменных заменяются на соответствующие строки содержимого константных файлов ostis-системы.
Этот агент вызывается в StandartMessageReplyAgent, чтобы создать ответную фразу по шаблону, вернуть ему свой результат и ответить на вопрос пользователя.

**Класс действий:**

`action_phrase_generation`


**Parameters:**

1. `replyMessageNode` является результатом работы StandartMessageReplyAgent;

2. `phraseLink` является файлом ostis-системы с шаблоном текста для ответного сообщения.

**Ход работы:**

* Агент пытается получить `templateNode`, который связан с `phraseLink` с помощью неролевого отношения `nrel_phrase_template`;

<img src="../images/phraseGenerationAgentStep1.png"></img>

* Далее ищет `parametersNode` - аргументы шаблона, данный узел связан с `actionAddr` с помощью ролевого отношения  `rrel_3`;
* После этого PhraseGenerationAgent генерирует sc-ссылку по шаблону, используя `templateNode`, `parametersNode` и  `phraseLink`;
* Язык, которому принадлежит файл ostis-системы, зависит от языка, которому принадлежал `phraseLink` файл ostis-системы . Если файл ostis-системы связан с `lang_ru` с помощью константной позитивной sc-дуги, проведенной от `lang_ru` к `phraseLink`, тогда агент тоже создаст такую же sc-дугу от `lang_ru` к `linkResult`. Если агент не находит язык файл ostis-системы, то он не создает никакой sc-дуги;
* В создаваемом файле ostis-системы агент находит все sc-переменные и используя `templateNode` подбирает необходимые sc-узлы из базы знаний. Переменные заменяются на идентификаторы найденных sc-узлов;
* Итоговый файл ostis-системы связывается с `actionAddr` с помощью неролевого отношения `nrel_result`, PhraseGenerationAgent завершает свою работу.  

### Пример

Пример входной структуры:

<img src="../images/phraseGenerationAgentStep2.png"></img>

Пример выходной структуры:

<img src="../images/phraseGenerationAgentStep3.png"></img>

### Результат

Возможные результаты:
 
* `SC_RESULT_OK` - файл ostis-системы с ответной фразой создан.
* `SC_RESULT_ERROR` - внутренняя ошибка, невозможно найти соответствующий шаблону фрагмент базы знаний.
* `SC_RESULT_ERROR_INVALID_PARAMS` - некорректные параметры действия.
